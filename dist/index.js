import e from"vanjs-core";class t{initialValues;fields;validator;validationMode;constructor(t){this.initialValues=t.initialValues,this.fields={},this.validator=t.validator??(e=>Promise.resolve(e)),this.validationMode=t.validationMode??"onsubmit";for(const i in t.initialValues)this.fields[i]={value:e.state(t.initialValues[i]),touched:e.state(!1),checked:e.state(!1),error:e.state("")}}register(t,s){const r=this.fields[t],o="radio"===s?.type;if(r){const a=e=>{const a=e.target,l=o?s?.value:a.value;if(r.value.val=l,s?.oninput?.(e),"oninput"===this.validationMode){const e={};for(const t in this.fields){const i=this.fields[t];e[t]=i.value.val}this.validator(e).then((e=>{if(e instanceof i){const i=e.errors[t];r.error.val=i??""}else r.error.val=""}))}},l=e=>{r.touched.val=!0,s?.onfocus?.(e)};return o?{...s,name:t,value:s?.value,checked:e.derive((()=>r.value.val===s?.value)),oninput:a,onfocus:l}:{...s,name:t,value:r.value,checked:r.checked,oninput:a,onfocus:l}}throw new Error(`No field named "${t}"`)}get(e){const t=this.fields[e];if(!t)throw new Error(`No field named "${e}"`);return t.value.val}set(e,t){const i=this.fields[e];if(!i)throw new Error(`No field named "${e}"`);i.value.val=t}error(e){const t=this.fields[e];if(!t)throw new Error(`No field named "${e}"`);return t.error.val}watch(...t){return e.derive((()=>{const e={};if(t.length>0)for(const i of t){const t=this.fields[i];e[i]=t.value.val}else for(const t in this.fields){const i=this.fields[t];e[t]=i.value.val}return e}))}reset(...e){if(e.length>0)for(const t of e){const e=this.fields[t];e.value.val=this.initialValues[t],e.checked.val=!1,e.touched.val=!1,e.error.val=""}else for(const e in this.fields){const t=this.fields[e];t.value.val=this.initialValues[e],t.checked.val=!1,t.touched.val=!1,t.error.val=""}}handleSubmit(e){return t=>{t.preventDefault();const s={};for(const e in this.fields){const t=this.fields[e];s[e]=t.value.val}this.validator(s).then((t=>{if(t instanceof i)for(const e in this.fields){const i=t.errors[e],s=this.fields[e];s&&(s.error.val=i??"")}else{for(const e in this.fields){this.fields[e].error.val=""}e(t)}}))}}}class i{errors;constructor(e){this.errors=e}}const s=e=>async t=>{try{return await e.validate(t,{abortEarly:!1})}catch(e){const t=e,s={};return t.errors.forEach(((e,i)=>{s[t.inner[i].path]=e})),new i(s)}};export{t as Form,s as yupValidator};
